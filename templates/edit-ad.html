<!DOCTYPE html>
<html lang="sv">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redigera annons - Beggy</title>
    <meta name="description" content="Redigera din annons p√• Beggy - En enkel svensk begagnatmarknad.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#c2410c",
              "primary-dark": "#9a3412",
              "amber-75": "#fef5e7",
            },
          },
        },
      }
    </script>
  </head>
  <body class="bg-stone-50 text-stone-800 leading-relaxed">
    <header class="bg-amber-50 shadow-md py-4 sticky top-0 z-50">
      <div class="max-w-6xl mx-auto px-5 flex items-center justify-between flex-wrap gap-2.5">
        <div class="flex items-center">
          <a href="/" class="text-2xl font-bold text-primary no-underline">Beggy</a>
          <span class="text-sm text-stone-500 ml-2 hidden sm:inline">K√∂p och s√§lj begagnat</span>
        </div>
        <nav class="nav flex items-center gap-5">
          <a href="/ny-annons" class="inline-block px-5 py-2.5 bg-primary text-white rounded text-base no-underline hover:bg-primary-dark transition-colors">S√§lj</a>
          <a href="#" id="loginBtn" class="text-stone-800 no-underline px-3 py-2 hover:text-primary">Logga in</a>
        </nav>
        <nav class="nav nav-logged-in hidden items-center gap-5">
          <a href="/ny-annons" class="inline-block px-5 py-2.5 bg-primary text-white rounded text-base no-underline hover:bg-primary-dark transition-colors">S√§lj</a>
          <a href="#" id="messagesBtn" class="text-stone-800 no-underline px-3 py-2 hover:text-primary">Meddelanden</a>
          <a href="#" id="myAdsBtn" class="text-stone-800 no-underline px-3 py-2 hover:text-primary">Mina annonser</a>
          <a href="#" id="logoutBtn" class="text-stone-800 no-underline px-3 py-2 hover:text-primary">Logga ut</a>
        </nav>
      </div>
    </header>

    <main class="min-h-[calc(100vh-200px)] py-8">
      <div class="max-w-6xl mx-auto px-5">
        <a href="/" class="text-primary no-underline mb-4 inline-block" id="backLink">&larr; Tillbaka</a>
        
        <div id="loginPrompt" class="p-8 text-center hidden">
          <h1 class="text-2xl font-bold mb-4">Redigera annons</h1>
          <p class="text-stone-500 mb-4">Du m√•ste vara inloggad f√∂r att redigera annonser.</p>
          <button onclick="openModal('loginModal')" class="px-5 py-2.5 bg-primary text-white rounded cursor-pointer text-base hover:bg-primary-dark transition-colors">Logga in</button>
        </div>
        
        <div id="loadingContainer" class="p-8 text-center">
          <p class="text-stone-500">Laddar annons...</p>
        </div>

        <div id="errorContainer" class="p-8 text-center hidden">
          <p class="text-red-500" id="errorMessage">Annonsen hittades inte eller s√• har du inte beh√∂righet att redigera den.</p>
        </div>
        
        <div id="editAdContainer" class="hidden">
          <h1 class="text-2xl font-bold mb-6">Redigera annons</h1>
          <form id="editAdForm">
            <div class="mb-4">
              <label for="adTitle" class="block mb-1 font-medium">Rubrik *</label>
              <input type="text" id="adTitle" required maxlength="100" class="w-full p-2.5 border border-stone-300 rounded text-base bg-white">
            </div>
            <div class="mb-4">
              <label for="adCategory" class="block mb-1 font-medium">Kategori *</label>
              <select id="adCategory" required class="w-full p-2.5 border border-stone-300 rounded text-base bg-white"></select>
            </div>
            <div class="mb-4">
              <label for="adPrice" class="block mb-1 font-medium">Pris (kr) *</label>
              <input type="number" id="adPrice" required min="0" class="w-full p-2.5 border border-stone-300 rounded text-base bg-white">
            </div>
            <div class="mb-4">
              <label for="adCounty" class="block mb-1 font-medium">L√§n *</label>
              <select id="adCounty" required aria-describedby="adCountyHelp" class="w-full p-2.5 border border-stone-300 rounded text-base bg-white"></select>
              <p id="adCountyHelp" class="text-sm text-stone-500 mt-1">Ange ort i beskrivningen om du vill vara mer specifik.</p>
            </div>
            <div class="mb-4">
              <label for="adDescription" class="block mb-1 font-medium">Beskrivning *</label>
              <textarea id="adDescription" required rows="5" class="w-full p-2.5 border border-stone-300 rounded text-base resize-y font-inherit bg-white"></textarea>
            </div>
            
            <!-- Existing Images -->
            <div class="mb-4" id="existingImagesSection">
              <label class="block mb-1 font-medium">Befintliga bilder</label>
              <div id="existingImagesContainer" class="flex gap-2.5 flex-wrap mb-2"></div>
            </div>
            
            <!-- Upload New Images -->
            <div class="mb-4">
              <label class="block mb-1 font-medium">L√§gg till nya bilder</label>
              <div id="imagePreviewContainer" class="flex gap-2.5 flex-wrap mb-2"></div>
              <input type="file" id="adImages" accept="image/*" multiple class="w-full p-2.5 border border-stone-300 rounded text-base bg-white">
              <p class="text-sm text-stone-500 mt-1" id="imageHelpText">V√§lj bilder att l√§gga till.</p>
            </div>
            
            <div class="mb-4">
              <label class="block mb-1 font-medium">Kontakts√§tt (valfritt)</label>
              <div class="bg-amber-50 border border-amber-300 rounded p-3 mb-2 text-sm text-amber-800">
                ‚ö†Ô∏è <strong>Varning:</strong> Om du anger telefon eller e-post nedan kommer det visas publikt p√• denna annons. Kontaktuppgifterna tas bort n√§r annonsen raderas. Anv√§nd ist√§llet v√•rt inbyggda meddelandesystem f√∂r s√§krare kontakt.
              </div>
              <input type="tel" id="adContactPhone" placeholder="Telefonnummer (visas publikt)" class="w-full p-2.5 border border-stone-300 rounded text-base mb-2 bg-white">
              <input type="email" id="adContactEmail" placeholder="Kontakt-e-post (visas publikt)" class="w-full p-2.5 border border-stone-300 rounded text-base bg-white">
            </div>
            <button type="submit" class="w-full px-5 py-2.5 bg-primary text-white rounded cursor-pointer text-base hover:bg-primary-dark transition-colors">Spara √§ndringar</button>
          </form>
        </div>
      </div>
    </main>

    <!-- Login Modal -->
    <div class="modal hidden fixed inset-0 bg-black/50 z-[1000] overflow-y-auto p-5" id="loginModal">
      <div class="bg-white max-w-md mx-auto mt-12 p-8 rounded-lg relative">
        <span class="close absolute top-4 right-5 text-2xl cursor-pointer text-gray-500 hover:text-gray-800" onclick="closeModal('loginModal')">&times;</span>
        <h2 class="text-xl font-semibold mb-4">Logga in</h2>
        <form id="loginForm">
          <div class="mb-4">
            <label for="loginEmail" class="block mb-1 font-medium">E-post</label>
            <input type="email" id="loginEmail" required class="w-full p-2.5 border border-gray-300 rounded text-base">
          </div>
          <div class="mb-4">
            <label for="loginPassword" class="block mb-1 font-medium">L√∂senord</label>
            <input type="password" id="loginPassword" required class="w-full p-2.5 border border-gray-300 rounded text-base">
          </div>
          <button type="submit" class="w-full px-5 py-2.5 bg-primary text-white rounded cursor-pointer text-base hover:bg-primary-dark transition-colors">Logga in</button>
          <p class="mt-4 text-center text-gray-500">Har du inget konto? <a href="#" id="showRegister" class="text-primary">Registrera dig</a></p>
        </form>
      </div>
    </div>

    <!-- Register Modal -->
    <div class="modal hidden fixed inset-0 bg-black/50 z-[1000] overflow-y-auto p-5" id="registerModal">
      <div class="bg-white max-w-md mx-auto mt-12 p-8 rounded-lg relative">
        <span class="close absolute top-4 right-5 text-2xl cursor-pointer text-gray-500 hover:text-gray-800" onclick="closeModal('registerModal')">&times;</span>
        <h2 class="text-xl font-semibold mb-4">Registrera dig</h2>
        <form id="registerForm">
          <div class="mb-4">
            <label for="regUsername" class="block mb-1 font-medium">Anv√§ndarnamn *</label>
            <input type="text" id="regUsername" required class="w-full p-2.5 border border-gray-300 rounded text-base">
          </div>
          <div class="mb-4">
            <label for="regEmail" class="block mb-1 font-medium">E-post *</label>
            <input type="email" id="regEmail" required class="w-full p-2.5 border border-gray-300 rounded text-base">
          </div>
          <div class="mb-4">
            <label for="regPassword" class="block mb-1 font-medium">L√∂senord * (minst 8 tecken)</label>
            <input type="password" id="regPassword" required minlength="8" class="w-full p-2.5 border border-gray-300 rounded text-base">
          </div>
          <button type="submit" class="w-full px-5 py-2.5 bg-primary text-white rounded cursor-pointer text-base hover:bg-primary-dark transition-colors">Registrera</button>
          <p class="mt-4 text-center text-gray-500">Har du redan ett konto? <a href="#" id="showLogin" class="text-primary">Logga in</a></p>
        </form>
      </div>
    </div>

    <!-- My Ads Modal -->
    <div class="modal hidden fixed inset-0 bg-black/50 z-[1000] overflow-y-auto p-5" id="myAdsModal">
      <div class="bg-white max-w-xl mx-auto mt-12 p-8 rounded-lg relative">
        <span class="close absolute top-4 right-5 text-2xl cursor-pointer text-gray-500 hover:text-gray-800" onclick="closeModal('myAdsModal')">&times;</span>
        <h2 class="text-xl font-semibold mb-4">Mina annonser</h2>
        <div id="myAdsList"></div>
        <hr class="my-5" />
        <h3 class="text-lg font-semibold">Kontoinst√§llningar</h3>
        <div class="flex gap-2.5 flex-wrap mt-4">
          <button class="px-4 py-2 border border-gray-300 rounded hover:bg-gray-100" onclick="exportMyData()">üì• Exportera mina data (GDPR)</button>
          <button class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700" onclick="deleteMyAccount()">üóëÔ∏è Radera mitt konto</button>
        </div>
        <p class="text-gray-500 text-sm mt-2.5">Du har r√§tt att exportera eller radera all din personliga data enligt GDPR.</p>
      </div>
    </div>

    <!-- Conversations Modal -->
    <div class="modal hidden fixed inset-0 bg-black/50 z-[1000] overflow-y-auto p-5" id="conversationsModal">
      <div class="bg-white max-w-xl mx-auto mt-12 p-8 rounded-lg relative">
        <span class="close absolute top-4 right-5 text-2xl cursor-pointer text-stone-500 hover:text-stone-800" onclick="closeModal('conversationsModal')">&times;</span>
        <h2 class="text-xl font-semibold mb-4">Meddelanden</h2>
        <p class="text-stone-500 mb-4 text-sm">Dina meddelanden √§r krypterade och kan bara l√§sas av dig och motparten.</p>
        <div id="conversationsList"></div>
      </div>
    </div>

    <!-- Chat Modal -->
    <div class="modal hidden fixed inset-0 bg-black/50 z-[1000] overflow-y-auto p-5" id="chatModal">
      <div class="bg-white max-w-xl mx-auto mt-12 p-8 rounded-lg relative flex flex-col" style="max-height: 80vh">
        <span class="close absolute top-4 right-5 text-2xl cursor-pointer text-stone-500 hover:text-stone-800" onclick="closeModal('chatModal')">&times;</span>
        <div id="chatHeader" class="mb-4"></div>
        <div id="chatMessages" class="flex-1 overflow-y-auto border border-stone-200 rounded p-4 mb-4 min-h-[200px] max-h-[400px]"></div>
        <form id="chatForm" class="flex gap-2">
          <input type="text" id="chatInput" placeholder="Skriv ett meddelande..." class="flex-1 p-2.5 border border-stone-300 rounded text-base" maxlength="2000">
          <button type="submit" class="px-5 py-2.5 bg-primary text-white rounded cursor-pointer text-base hover:bg-primary-dark transition-colors">Skicka</button>
        </form>
      </div>
    </div>

    <footer class="bg-amber-75 py-8 mt-8 border-t border-stone-300">
      <div class="max-w-6xl mx-auto px-5">
        <div class="flex justify-center gap-8 mb-4 flex-wrap">
          <a href="/om" class="text-stone-500 no-underline hover:text-primary">Om Beggy</a>
          <a href="/villkor" class="text-stone-500 no-underline hover:text-primary">Anv√§ndarvillkor</a>
          <a href="/integritetspolicy" class="text-stone-500 no-underline hover:text-primary">Integritetspolicy</a>
        </div>
        <p class="text-center text-stone-500 text-sm">&copy; 2025 Beggy - √ñppen k√§llkod p√• <a href="https://github.com/Hexagon/beggy" target="_blank" class="text-primary">GitHub</a></p>
      </div>
    </footer>

    <script src="/js/edit-ad.js"></script>
  </body>
</html>
